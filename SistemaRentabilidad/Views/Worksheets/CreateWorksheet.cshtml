

@{
    ViewBag.Title = "Nueva Planilla";
}
<head>

    <style>
         /*@@media (max-width: 767px) {

               .sugn {
                display: none !important;
            }
        }*/
         .bootstrap-select{width: auto !important;}
        .withoutborders {
            border-left: none;
            border-right: none;
            border-top: none;
            border-bottom-color: mediumseagreen !important;
        }

        legend {
            margin-bottom: 2px !important;
            font-size: inherit !important;
        }

      
        textarea {
            max-width: 100% !important;
            resize: none !important;
            line-height: 1.08 !important;
            border-width: 1px !important;
        }

        #resumentabla td {
            line-height: 15px !important;
        }

        #nueva td {
            line-height: 15px !important;
        }

        #ingresotabla td {
            line-height: 15px !important;
        }

        #encabezadostabla td {
            line-height: 15px !important;
        }

        #costotabla td {
            line-height: 15px !important;
        }

        #gastotabla td {
            line-height: 15px !important;
        }

        #otrotabla td {
            line-height: 15px !important;
        }

        #ingresotabla th {
            line-height: 15px !important;
        }

        #costotabla th {
            line-height: 15px !important;
        }

        #gastotabla th {
            line-height: 15px !important;
        }

        #otrotabla th {
            line-height: 15px !important;
        }

        #nueva th {
            line-height: 15px !important;
        }

        #resumentabla th {
            line-height: 15px !important;
        }

        #otrosub th {
            line-height: 15px !important;
        }

        #encabezadostabla th {
            line-height: 15px !important;
        }

        #totalingresotabla th {
            line-height: 15px !important;
        }

        #totalgastotabla th {
            line-height: 15px !important;
        }

        #totalcostotabla th {
            line-height: 15px !important;
        }

        #totalotrotabla th {
            line-height: 15px !important;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
            margin: 0 !important;
        }
        .btn-group-justified {
            display: inline !important;
        }
        .tipos {
            font-size: medium !important;
            font-weight: bold !important;
            font-style: italic !important;
        }

       

        .table {
            margin-bottom: 0px !important;
        }
    </style></head>



@*<h2 class="text-center">Nueva Planilla</h2>
<hr/>*@

@*///////////////////////////*@


<br />
<table id="titulotabla" class="table table-bordered chica">

    <thead class="tableStyle">


        <tr class="text-center tipos thStyleGradient2 bordesRedond">


            <th class="text-center col-lg-6" style="padding: 2px">
                Planilla
            </th>

            <th class="text-center col-lg-6" style="padding: 2px">
                Periodo
            </th>
        </tr>
    </thead>
    <tbody>


    <td class="text-center fondoBlanco">
        <label>Nueva</label>
        <span class="text-danger" style="display: block"></span>

    </td>
    <td class="text-center fondoBlanco" style="padding-bottom: 0px;">
        <input type="text" class="withoutborders  form-control-sm" id="wdate" @*value="@DateTime.Now.ToString("MMMM/yyyy")"*@ @*value="@DateTime.Now.ToString("yyyy-MM")"*@ placeholder="Mes/Año" onchange="valfecha()" style="text-transform: capitalize; height: 25px; text-align: center;width: auto" />
        <span class="text-danger text-center" id="spanwdate" style="display: block"></span>
    </td>

    </tbody>

</table>

<legend class="text-center thStyleGradient2 " style="font-size: larger;margin-bottom: 0px;margin-top: 5px;">
    <b>Nueva entrada</b>
</legend>
<table id="nueva" class="table table-condensed table-bordered chica" style="margin-bottom: 10px; background: transparent;border-right: none">
    <thead>
        <tr class="text-center thStyleGradient3">
            <th class="text-center">
                Tipo
            </th>
            <th class="text-center" style="width: 40%">
                Transacción
            </th>
            <th class="text-center sugn" style="width: 40%">
                Observación
            </th>

            <th class="text-center">
                Monto<i>($)</i>
            </th>

        </tr>
    </thead>
    <tbody id="nueva">
        <tr style="border-right: none">
            <td>
                <div class="btn-group btn-group-justified" data-toggle="buttons" style="display: inline-block">
                    <label class="btn btn-info btn-xs active" value="ing" onclick="acting(this)">
                        <input id="buttonsType" type="radio" name="options" value="ing" onclick="acttipo(this)" autocomplete="off" checked>Ingreso
                    </label>
                    <label class="btn btn-info btn-xs" value="cos" onclick="actcos(this)">
                        <input type="radio" name="options" value="cos" autocomplete="off">Costo
                    </label>
                    <label class="btn btn-info btn-xs" value="gas" onclick="actgas(this)">
                        <input type="radio" name="options" value="gas" autocomplete="off">Gasto
                    </label>
                    <label class="btn btn-info btn-xs" value="otr" onclick="actotr(this)">
                        <input type="radio" name="options" value="otr" autocomplete="off">Otro ing.
                    </label>
                </div>
            </td>
            <td class="text-center fina">
                <textarea type="text" rows='1' placeholder="Cuenta (ejemplo: pago de impuestos)" class="panel-info form-control-sm inputForm inputForm3  fc sug nuev" id="ndescription" maxlength="140" placeholder="" style="max-width: 100%"></textarea>
                <span class="text-danger" id="spanndescription" style="display: block"></span>
            </td>
            <td class="text-center fina">
                <textarea type="text" rows='1' placeholder="(opcional)" class="panel-info form-control-sm inputForm inputForm3 fc nuev" maxlength="140" id="ncomment" placeholder="" style="max-width: 100%"></textarea>
                <span class="text-danger" style="display: block"></span>
            </td>
            <td class="fina">
                <input type="number" min="0" max="9999999999" maxlength="10" oninput="maxvalue(this);" class="panel-info form-control-sm inputForm inputForm3 fc montocentrado" style="width: 100px; font-size: smaller; height: 22px; border-width: 1px" value="1" id="namount" onkeypress="solonumerosptocoma();" />
                <span class="text-danger" style="display: block"></span>
            </td>
            <td class="fina" style="border: none">
                <button type="button" onkeypress="gotoButtons()" id="addn" class="btn btn-success btn-xs add" value="nueva" />
                <span class="glyphicon glyphicon-plus"></span>
            </td>
        </tr>
    </tbody>
    
</table>
<table id="encabezadostabla" class="table table-condensed table-bordered " style="margin-bottom: 2px">
    <thead>
        <tr class="text-center thStyleGradient3">
            <th class="text-left" style="width: 40%">
                Transacción @*<span class="btn btn-xs" onclick="mostrar()">*</span>*@
            </th>
            <th class="text-left sugn" style="width: 40%">
                Observación
            </th>
            <th class="text-center" style="width: 20%">
                Monto ($)
            </th>
        </tr>
    </thead>
</table>

<legend class="thStyleGradient bordesRedond3 tipos col-lg-12 ">
    Ingresos
</legend>

<table id="ingresotabla" class="table table-condensed table-bordered chica">

    <tbody id="ingreso"><tr></tr></tbody>

</table>
<table id="totalingresotabla" class="table table-condensed table-bordered chica tottable" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden; border-left: hidden;">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left totalViewKhaki montocentrado" id="toting">
                0.00
            </th>
            <th style="width: 2.2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px;margin-bottom: 5px;border-style: dashed" />

<legend class="thStyleGradient bordesRedond3 tipos col-lg-12 ">
    Costos
</legend>
<table id="costotabla" class="table table-condensed table-bordered chica">

    <tbody id="costo">
        <tr></tr>
    </tbody>

</table>
<table id="totalcostotabla" class="table table-condensed table-bordered chica tottable" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left totalViewKhaki montocentrado" id="totcos">
                0.00
            </th>
            <th style="width: 2.2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px;margin-bottom: 5px;border-style: dashed" />

<legend class="thStyleGradient bordesRedond3 tipos col-lg-12  ">
    Gastos
</legend>
<table id="gastotabla" class="table table-condensed table-bordered chica">

    <tbody id="gasto">
        <tr></tr>
    </tbody>

</table>
<table id="totalgastotabla" class="table table-condensed table-bordered chica tottable" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%;border-bottom: hidden; border-top: hidden; border-left: hidden; font-weight: bolder;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left totalViewKhaki montocentrado" id="totgas">
                0.00
            </th>
            <th style="width: 2.2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px;margin-bottom: 5px;border-style: dashed" />

<legend class="thStyleGradient bordesRedond3 tipos col-lg-12  ">
    Otros ingresos
</legend>
<table id="otrotabla" class="table table-condensed table-bordered chica">

    <tbody id="otro">
        <tr></tr>
    </tbody>
</table>
<table id="totalotrotabla" class="table table-condensed table-bordered chica tottable" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left totalViewKhaki montocentrado" id="tototr">
                0.00
            </th>
            <th style="width: 2.2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>

<hr style="margin-top: 2px;margin-bottom: 5px;border-style: dashed" />


<div>
    <div id="orderItemsi">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<div>
    <div id="orderItemsc">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<div>
    <div id="orderItemsg">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<div>
    <div id="orderItemso">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<legend class="tipos text-center thStyleGradient2 ">
    Resumen
</legend>
<table id="resumentabla" class="table table-condensed    table-bordered chica">

    <thead class="tableStyle">
        <tr class="text-center thStyleGradient3">
            <td class="text-left" style="border-radius: 3px; font-weight: bold">
                Obs. Grales.
            </td>
            <td class="text-center" style="border-radius: 3px; width: 200px; font-weight: bold">
                Total
            </td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <textarea type="text" rows='1' class="panel-info form-control-sm inputForm withoutborders inputForm3  fc" maxlength="140" style="max-width: 100%" id="wcomments" placeholder=""></textarea>

            </td>
            <td style="background: khaki;">
                <input readonly="readonly" type="text" class="panel-info text-center totalView" value="0.00" id="wtotal" placeholder="" style="font-weight: bold" />
                <span class="text-danger" style="display: block"></span>
            </td>

        </tr>

    </tbody>

</table>

<br/>

<div style="width: 100%; display: flex">
    <div style="width: 25%; text-align: left">
        <a href="@Url.Action("Index", "Worksheets")" class="btn btn-primary btn-md"><span class="glyphicon glyphicon-hand-left " aria-hidden="true"></span>&nbsp; Volver</a>
    </div>
    <div style="width: 50%; text-align: center">
        <button type="button" id="submit" class="btn btn-success  btn-md" value="Guardar" style="margin-left: 30px">
            Guardar &nbsp;<span class="glyphicon glyphicon-floppy-disk"></span>
        </button>
    </div>
    <div style="width: 25%"></div>
</div>


<br />

<div id="GSCCModal" class="modal fade" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 100%">
        <div class="modal-content" style="width: 84%; left: 8%">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="font-size: xx-large">&times;</button>
                <h4 class="modal-title text-center">Ayuda</h4>
            </div>
            <div class="modal-body">
                @Html.Action("HelpCreate", "Worksheets")
            </div>
            <div class="modal-footer" style="text-align: center">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>

    </div>

</div>

@section Scripts{





    <script src="@Url.Content("~/Scripts/solonumerosptocoma.js")"></script>
    <script src="@Url.Content("~/Scripts/maxvalue.js")"></script>
    <script>
        function mostrar() {$( ".sugn" ).toggle();}

        $("body").on("click", "a.dialog-window", null, function(e) {
            e.preventDefault();

            var $link = $(this); // Reference to <a/> link
            var title = $link.text(); //this is title to fetch in htnl
            $('#myModal.modal-title').html(title);

            var url = $(this).attr('href');
            if (url.indexOf('#') == 0) {
                $('#myModal').modal('show');
            } else {
                $.get(url, function(data) {
                    $('#myModal .te').html(data);
                    $('#myModal').modal();
                }).success(function() { $('input:text:visible:first').focus(); });
            }
        });

        function valfecha() {
            var periodo = traducirmes($('#wdate').val());
            if (periodo == ''| periodo == null) {
                $('#spanwdate').html('Requerido');
                valf = 2;
            } else {
                //$('#wdate').siblings('span.text-danger').html('');
                var options3 = {};
                options3.url = '@Url.Action("ExistePlanilla", "Worksheets")';
                options3.type = "GET";
                options3.data = { "fecha": periodo };
                options3.dataType = "json";
                options3.success = function(data) {
                    if (data) {
                        $('#spanwdate').html('Período existente.');
                        valf = 1;
                    } else {
                        $('#spanwdate').html('');
                        valf = 0;
                    };

                };
                $.ajax(options3);
            }
        }


        function valdescb(x) {
            if (x.value.trim() == "" || x.value == null) {

                $(x).closest('td').find('.text-danger').html('Requerido.');

            } else {
                $(x).closest('td').find('.text-danger').html('');
            };
        }


        function valamoub(x) {
            if (x.value.trim() == "" || x.value == null) {
                $(x).siblings('span.text-danger').html('Requerido.');

            } else {
                if (x.value.trim() == 0) {
                    $(x).siblings('span.text-danger').html('Debe ser mayor a 0.');
                } else {
                    $(x).siblings('span.text-danger').html('');
                }
            };
        }


        function arraysamountsedit() {
            itemsi = [];
            itemsiamounts = [];
            itemsc = [];
            itemscamounts = [];
            itemsg = [];
            itemsgamounts = [];
            itemso = [];
            itemsoamounts = [];

            $("input[name='ing_Amount']").map(function() { itemsiamounts.push(parseFloat(this.value)) });
            $("input[name='cos_Amount']").map(function() { itemscamounts.push(parseFloat(this.value)) });
            $("input[name='gas_Amount']").map(function() { itemsgamounts.push(parseFloat(this.value)) });
            $("input[name='otr_Amount']").map(function() { itemsoamounts.push(parseFloat(this.value)) });

        }

        function arraysedit() {
            itemsi = [];
            itemsidescriptions = [];
            itemsicomments = [];
            itemsiamounts = [];

            itemsc = [];
            itemscdescriptions = [];
            itemsccomments = [];
            itemscamounts = [];

            itemsg = [];
            itemsgdescriptions = [];
            itemsgcomments = [];
            itemsgamounts = [];

            itemso = [];
            itemsodescriptions = [];
            itemsocomments = [];
            itemsoamounts = [];
            $("textarea[name='ing_SheetDescription']").map(function() { itemsidescriptions.push((this.value)) });
            $("textarea[name='ing_Comments']").map(function() { itemsicomments.push((this.value)) });
            $("input[name='ing_Amount']").map(function() { itemsiamounts.push(parseFloat(this.value)) });

            $("textarea[name='cos_SheetDescription']").map(function() { itemscdescriptions.push((this.value)) });
            $("textarea[name='cos_Comments']").map(function() { itemsccomments.push((this.value)) });
            $("input[name='cos_Amount']").map(function() { itemscamounts.push(parseFloat(this.value)) });

            $("textarea[name='gas_SheetDescription']").map(function() { itemsgdescriptions.push((this.value)) });
            $("textarea[name='gas_Comments']").map(function() { itemsgcomments.push((this.value)) });
            $("input[name='gas_Amount']").map(function() { itemsgamounts.push(parseFloat(this.value)) });

            $("textarea[name='otr_SheetDescription']").map(function() { itemsodescriptions.push((this.value)) });
            $("textarea[name='otr_Comments']").map(function() { itemsocomments.push((this.value)) });
            $("input[name='otr_Amount']").map(function() { itemsoamounts.push(parseFloat(this.value)) });


            for (i = 0; i < itemsidescriptions.length; i++) {

                itemsi.push({
                    SheetDescription: itemsidescriptions[i],
                    Comments: itemsicomments[i],
                    Amount: itemsiamounts[i],
                    SheetType: 0

                });
            }

            for (i = 0; i < itemscdescriptions.length; i++) {

                itemsc.push({
                    SheetDescription: itemscdescriptions[i],
                    Comments: itemsccomments[i],
                    Amount: itemscamounts[i],
                    SheetType: 1

                });
            }
            for (i = 0; i < itemsgdescriptions.length; i++) {

                itemsg.push({
                    SheetDescription: itemsgdescriptions[i],
                    Comments: itemsgcomments[i],
                    Amount: itemsgamounts[i],
                    SheetType: 2

                });
            }
            for (i = 0; i < itemsodescriptions.length; i++) {

                itemso.push({
                    SheetDescription: itemsodescriptions[i],
                    Comments: itemsocomments[i],
                    Amount: itemsoamounts[i],
                    SheetType: 3

                });
            }
        }

        function calcing() {
            ting = 0;
            $.each(itemsiamounts, function() { ting += parseFloat(this) || 0; });
            $('#toting').html(ting.toFixed(2));
        }

        function calccos() {
            tcos = 0;
            $.each(itemscamounts, function() { tcos += parseFloat(this) || 0; });
            $('#totcos').html(tcos.toFixed(2));

        }

        function calcgas() {
            tgas = 0;
            $.each(itemsgamounts, function() { tgas += parseFloat(this) || 0; });
            $('#totgas').html(tgas.toFixed(2));
        }

        function calcotr() {
            totr = 0;
            $.each(itemsoamounts, function() { totr += parseFloat(this) || 0; });
            $('#tototr').html(totr.toFixed(2));

        }

        function calculogral() {
            arraysamountsedit();
            tgral = 0;
            $.each(itemsiamounts, function() { tgral += parseFloat(this) || 0; });
            $.each(itemsoamounts, function() { tgral += parseFloat(this) || 0; });
            $.each(itemsgamounts, function() { tgral -= parseFloat(this) || 0; });
            $.each(itemscamounts, function() { tgral -= parseFloat(this) || 0; });
            document.getElementById("wtotal").value = tgral.toFixed(2);
        }


        function borrarfilaingb(row) {
            var a = $(row).closest('td').siblings(':first-child').text();

            toastr.warning("-" + a + "-<br/>Eliminado.", "Ingreso:");
            row.closest('tr').remove();
            arraysamountsedit();
            calcing();
            calccos();
            calcgas();
            calcotr();
            calculogral();
        }

        function gotoButtons() {

            $("#buttonsType").focus();
        }

        function borrarfilacosb(row) {
            var a = $(row).closest('td').siblings(':first-child').text();
            toastr.warning("-" + a + "-<br/>Eliminado.", "Costo:");
            row.closest('tr').remove();
            arraysamountsedit();
            calcing();
            calccos();
            calcgas();
            calcotr();
            calculogral();
        }


        function borrarfilagasb(row) {
            var a = $(row).closest('td').siblings(':first-child').text();
            toastr.warning("-" + a + "-<br/>Eliminado.", "Gasto:");
            row.closest('tr').remove();
            arraysamountsedit();
            calcing();
            calccos();
            calcgas();
            calcotr();
            calculogral();
        }

        function borrarfilaotrb(row) {
            var a = $(row).closest('td').siblings(':first-child').text();

            toastr.warning("-" + a + "-<br/>Eliminado.", "Otro ingreso:");
            row.closest('tr').remove();
            arraysamountsedit();
            calcing();
            calccos();
            calcgas();
            calcotr();
            calculogral();
        }

        function renewi() {
            orderItemsi = [];
            orderItemsidescriptions = [];
            orderItemsicomments = [];
            orderItemsiamounts = [];

            $("textarea[id='ing_SheetDescriptionz']").map(function() { orderItemsidescriptions.push((this.value)) });
            $("textarea[id='ing_Commentsz']").map(function() { orderItemsicomments.push((this.value)) });
            $("input[id='ing_Amountz']").map(function() { orderItemsiamounts.push(parseFloat(this.value)) });

            for (i = 0; i < orderItemsidescriptions.length; i++) {

                orderItemsi.push({
                    SheetDescription: orderItemsidescriptions[i],
                    Comments: orderItemsicomments[i],
                    Amount: orderItemsiamounts[i],
                    SheetType: 0

                });
            }

        }

        function renewc() {


            orderItemsc = [];
            orderItemscdescriptions = [];
            orderItemsccomments = [];
            orderItemscamounts = [];

            $("textarea[id='cos_SheetDescriptionz']").map(function() { orderItemscdescriptions.push((this.value)) });
            $("textarea[id='cos_Commentsz']").map(function() { orderItemsccomments.push((this.value)) });
            $("input[id='cos_Amountz']").map(function() { orderItemscamounts.push(parseFloat(this.value)) });

            for (i = 0; i < orderItemscdescriptions.length; i++) {

                orderItemsc.push({
                    SheetDescription: orderItemscdescriptions[i],
                    Comments: orderItemsccomments[i],
                    Amount: orderItemscamounts[i],
                    SheetType: 1

                });
            }

        }


        function renewg() {
            orderItemsg = [];
            orderItemsgdescriptions = [];
            orderItemsgcomments = [];
            orderItemsgamounts = [];

            $("textarea[id='gas_SheetDescriptionz']").map(function() { orderItemsgdescriptions.push((this.value)) });
            $("textarea[id='gas_Commentsz']").map(function() { orderItemsgcomments.push((this.value)) });
            $("input[id='gas_Amountz']").map(function() { orderItemsgamounts.push(parseFloat(this.value)) });

            for (i = 0; i < orderItemsgdescriptions.length; i++) {

                orderItemsg.push({
                    SheetDescription: orderItemsgdescriptions[i],
                    Comments: orderItemsgcomments[i],
                    Amount: orderItemsgamounts[i],
                    SheetType: 2

                });
            }

        }

        function renewo() {
            orderItemso = [];
            orderItemsodescriptions = [];
            orderItemsocomments = [];
            orderItemsoamounts = [];

            $("textarea[id='otr_SheetDescriptionz']").map(function() { orderItemsodescriptions.push((this.value)) });
            $("textarea[id='otr_Commentsz']").map(function() { orderItemsocomments.push((this.value)) });
            $("input[id='otr_Amountz']").map(function() { orderItemsoamounts.push(parseFloat(this.value)) });

            for (i = 0; i < orderItemsodescriptions.length; i++) {

                orderItemso.push({
                    SheetDescription: orderItemsodescriptions[i],
                    Comments: orderItemsocomments[i],
                    Amount: orderItemsoamounts[i],
                    SheetType: 3

                });
            }
        }


        function acting(a) { tipo = "ing"; }

        function actcos(a) { tipo = "cos"; }

        function actgas(a) { tipo = "gas"; }

        function actotr(a) { tipo = "otr"; }

        function isug() {

            $.each($(".sug"), function() {

                if ($(this).hasClass("awe") == false) {
                    $(this).addClass("awe");
                    new Awesomplete(this, {
                        list: linesarray
                    });
                }
            });
            $.each($(".sugi"), function() {

                if ($(this).hasClass("awe") == false) {
                    $(this).addClass("awe");
                    new Awesomplete(this, {
                        list: linesiarray
                    });
                }
            });
            $.each($(".sugc"), function() {

                if ($(this).hasClass("awe") == false) {
                    $(this).addClass("awe");
                    new Awesomplete(this, {
                        list: linescarray
                    });
                }
            });
            $.each($(".sugg"), function() {

                if ($(this).hasClass("awe") == false) {
                    $(this).addClass("awe");
                    new Awesomplete(this, {
                        list: linesgarray
                    });
                }
            });
            $.each($(".sugo"), function() {

                if ($(this).hasClass("awe") == false) {
                    $(this).addClass("awe");
                    new Awesomplete(this, {
                        list: linesoarray
                    });
                }
            });


        }

        function itextarea() {
            $('textarea').each(function() {
                autosize(this);
                this.style.display = '';
                autosize.update(this);
            });
            isug();

        }

        $(document).ready(function() {
            



            $('.selectpicker').selectpicker({
                size: 4,
                style: 'btn-info'
            });
            $('.selectpicker').on('changed.bs.select', function () {
                if(this.value=="ing"){acting();}
                else{ if(this.value=="cos"){actcos();}
                else{if(this.value=="gas"){actgas();}
                else{if(this.value=="otr"){actotr();}
}
                }}
              
            });

            $('#wdate').datepicker({
                format: "MM/yyyy",
                startView: 1,
                minViewMode: 1,
                maxViewMode: 2,
                todayBtn: "linked",
                clearBtn: true,
                language: "es",
                autoclose: true,todayHighlight: true

            }).datepicker("setDate", "0");

            lines = @Html.Raw(ViewBag.lines);
            linesi = @Html.Raw(ViewBag.linesi);
            linesc = @Html.Raw(ViewBag.linesc);
            linesg = @Html.Raw(ViewBag.linesg);
            lineso = @Html.Raw(ViewBag.lineso);
            linesarray = [];
            linesiarray = [];
            linescarray = [];
            linesgarray = [];
            linesoarray = [];
            $.each(lines, function(index, value) {
                linesarray.push(value);

            });
            $.each(linesi, function(index, value) {
                linesiarray.push(value);

            });
            $.each(linesc, function(index, value) {
                linescarray.push(value);

            });
            $.each(linesg, function(index, value) {
                linesgarray.push(value);

            });
            $.each(lineso, function(index, value) {
                linesoarray.push(value);

            });


            valfecha();
            itextarea();


            tipo = "ing";

            orderItems = [];
            orderItemsi = [];
            orderItemsc = [];
            orderItemsg = [];
            orderItemso = [];

            toting = [];
            totcos = [];
            totgas = [];
            tototr = [];
            //////////ADD INGRESO///////////////
            ///////////////////////////
            //////////////////////
            //Add button click function

            $('#addn').click(function() {


                var isValidItem = true;

                //Check validation of order item
                if ($('#ndescription').val().trim() == '') {
                    isValidItem = false;
                    $('#spanndescription').html('Requerido');
                } else {
                    $('#spanndescription').html('');
                }

                if ($('#namount').val().trim() == '') {
                    isValidItem = false;
                    $('#namount').siblings('span.text-danger').html('Requerido');
                } else {
                    if ($('#namount').val().trim() == 0) {
                        isValidItem = false;
                        $('#namount').siblings('span.text-danger').html('Debe ser mayor a 0');
                    } else {
                        $('#namount').siblings('span.text-danger').html('');
                    }
                }


                if (isValidItem) {


                    var SheetDescription = $('#ndescription').val().trim();
                    var Amount = $('#namount').val().trim();
                    var Comments = $('#ncomment').val().trim();

                    if (tipo == "ing") {
                        renewi();
                        var SheetType = 0;
                        orderItemsi.push({
                            SheetDescription: SheetDescription,
                            Amount: Amount,
                            Comments: Comments,
                            SheetType: SheetType
                        });

                        toastr.info("-" + SheetDescription + "-<br/>Agregado.", "Ingreso:");
                        ingreso();
                    };
                    if (tipo == "cos") {
                        renewc();
                        var SheetType = 1;
                        orderItemsc.push({
                            SheetDescription: SheetDescription,
                            Amount: Amount,
                            Comments: Comments,
                            SheetType: SheetType
                        });

                        toastr.info("-" + SheetDescription + "-<br/>Agregado.", "Costo:");
                        costo();
                    };
                    if (tipo == "gas") {
                        renewg();
                        var SheetType = 2;
                        orderItemsg.push({
                            SheetDescription: SheetDescription,
                            Amount: Amount,
                            Comments: Comments,
                            SheetType: SheetType
                        });

                        toastr.info("-" + SheetDescription + "-<br/>Agregado.", "Gasto:");
                        gasto();
                    };
                    if (tipo == "otr") {
                        renewo();
                        var SheetType = 3;
                        orderItemso.push({
                            SheetDescription: SheetDescription,
                            Amount: Amount,
                            Comments: Comments,
                            SheetType: SheetType
                        });

                        toastr.info("-" + SheetDescription + "-<br/>Agregado.", "Otro ingreso:");
                        otro();
                    };
                    $('#ndescription,#namount,#ncomment').val('');
                    $('.nuev').each(function() {
                        autosize(this);
                        this.style.display = '';
                        autosize.update(this);
                    });
                }

            });


            //Save button click function
            $('#submit').click(function() {
                //validation of order
                var isAllValid = true;


//if ($('#wdescription').val().trim() == '') {
                //    $('#wdescription').siblings('span.text-danger').html('Requerido');
                //    isAllValid = false;
                //} else {
                //    $('#wdescription').siblings('span.text-danger').html('');
                //}

                if ($('#wdate').val().trim() == '') {
                    $('#spanwdate').html('Requerido');
                    isAllValid = false;
                } else {
                    $('#spanwdate').html('');
                }

                $("textarea[name='ing_SheetDescription']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spaniteming_SheetDescription' + b).html('Requerido');

                        isAllValid = false;
                    } else {
                        $('#spaniteming_SheetDescription' + b).html('');
                    }

                });

                $("textarea[name='cos_SheetDescription']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spanitemcos_SheetDescription' + b).html('Requerido');
                        isAllValid = false;
                    } else {
                        $('#spanitemcos_SheetDescription' + b).html('');
                    }

                });

                $("textarea[name='gas_SheetDescription']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spanitemgas_SheetDescription' + b).html('Requerido');
                        isAllValid = false;
                    } else {
                        $('#spanitemgas_SheetDescription' + b).html('');
                    }

                });

                $("textarea[name='otr_SheetDescription']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spanitemotr_SheetDescription' + b).html('Requerido');
                        isAllValid = false;
                    } else {
                        $('#spanitemotr_SheetDescription' + b).html('');
                    }

                });
                $("input[name='ing_Amount']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spaniteming_Amount' + b).html('Requerido');
                        isAllValid = false;
                    } else {
                        if (this.value.trim() == 0) {
                            $('#spaniteming_Amount' + b).html('Debe ser mayor a 0.');
                            isAllValid = false;
                        } else {
                            $('#spaniteming_Amount' + b).html('');

                        }
                    }
                });
                $("input[name='cos_Amount']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spanitemcos_Amount' + b).html('Requerido');

                        isAllValid = false;
                    } else {
                        if (this.value.trim() == 0) {
                            $('#spanitemcos_Amount' + b).html('Debe ser mayor a 0.');

                            isAllValid = false;
                        } else {
                            $('#spanitemcos_Amount' + b).html('');

                        }
                    }
                });
                $("input[name='gas_Amount']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spanitemgas_Amount' + b).html('Requerido');

                        isAllValid = false;
                    } else {
                        if (this.value.trim() == 0) {
                            $('#spanitemgas_Amount' + b).html('Debe ser mayor a 0.');

                            isAllValid = false;
                        } else {
                            $('#spanitemgas_Amount' + b).html('');

                        }
                    }
                });
                $("input[name='otr_Amount']").map(function() {
                    var a = this.id;

                    var b = a.replace(/\D/g, '');
                    if (this.value.trim() == "" || this.value == null) {
                        $('#spanitemotr_Amount' + b).html('Requerido.');

                        isAllValid = false;
                    } else {
                        if (this.value.trim() == 0) {
                            $('#spanitemotr_Amount' + b).html('Debe ser mayor a 0.');

                            isAllValid = false;
                        } else {
                            $('#spanitemotr_Amount' + b).html('');

                        }
                    }
                });


                arraysedit();
                orderItems = $.merge(itemsi, itemsc);
                orderItems = $.merge(orderItems, itemsg);
                orderItems = $.merge(orderItems, itemso);

                if (orderItems.length == 0) {
                    //bootbox.alert({
                    //    title: "Aviso",
                    //    message: "Es necesario agregar al menos una línea para guardar la planilla. ",
                    //    backdrop: true
                    //});
                    toastr["error"]("Es necesario agregar al menos una transacción para guardar la planilla. ");
                    valfecha();
                    isAllValid = false;

                }
                if (valf == 1) {
                    isAllValid = false;
                    toastr["error"]("El período ingresado ya existe.");
                    $('#wdate').siblings('span.text-danger').html('Período existente.');

                }
                if (valf == 2) {
                    isAllValid = false;
                    toastr["error"]("Periodo requerido.");
                    $('#spanwdate').html('Requerido');

                }

                if (isAllValid == false) {
                    toastr["error"]("Uno o más campos son incorrectos.", "Error al guardar");
                }
                //Save if valid
                if (isAllValid) {
                    bootbox.confirm({message:"Está por guardar la planilla, ¿Desea continuar?",
                    buttons: {
                        confirm: {
                                label: 'Aceptar',
                                className: 'btn-success'
                        },
                        cancel: {
                            label: 'Cancelar',
                            className: 'btn-default'
                        }
                    },
                        callback:function(result1) {

                        if (result1) {
                            var data = {
                                Date: $('#wdate').val().trim(),
                                Comments: $('#wcomments').val().trim(),
                                Sheets: orderItems,
                                Totali: $('#toting').html().trim(),
                                Totalc: $('#totcos').html().trim(),
                                Totalg: $('#totgas').html().trim(),
                                Totalo: $('#tototr').html().trim(),
                                TotalAmount: $('#wtotal').val().trim()
                            }

                            $(this).val('Please wait...');
                            $("#loader").show();

                            $.ajax({
                                url: '@Url.Action("CreateWorksheet", "Worksheets")',
                                type: "POST",
                                data: JSON.stringify(data),
                                dataType: "JSON",
                                contentType: "application/json",
                                success: function(d) {
                                    //check is successfully save to database
                                    if (d.status == true) {
                                        var url = '@Url.Action("Index", "Worksheets", new {x = 0})';
                                        window.location.href = url;
                                    } else {
                                        $("#loader").hide();

                                        bootbox.alert(d.mensaje);
                                    }
                                    $('#submit').val('Save');
                                },
                                error: function() {
                                    alert('Error. Please try again.');
                                    $('#submit').val('Save');
                                }
                            });

                        }
                    }});
                }

            });


            //functiones agregar ing cos gas otr/////////////
            /////////////////////
            function ingreso() {

                $('.elimi').remove();
                if (orderItemsi.length > 0) {
                    $('#orderItemsi').html('<span class="text-danger"></span>');
                    $.each(orderItemsi, function(i, val) {
                        var $rowi = $('<tr class="elimi"></tr>');

                        $rowi.append($('<td style="width: 40%"><textarea maxlength="140" id="ing_SheetDescriptionz" Name="ing_SheetDescription" rows="1" class= "form-control-sm inputForm withoutborders fc sugi" value="' + val.SheetDescription + '" onkeyup = "valdescb(this)" oninput = "valdescb(this)" onkeypress = "valdescb(this)">' + val.SheetDescription + '</textarea><span class="text-danger" ></span></td>'));
                        $rowi.append($('<td style="width: 40%" class="sugn"><textarea maxlength="140" id="ing_Commentsz" Name="ing_Comments" rows="1" class= "form-control-sm inputForm withoutborders fc" value="' + val.Comments + '">' + val.Comments + '</textarea><span class="text-danger"></span></td>'));
                        $rowi.append($('<td><input type="number" id="ing_Amountz" maxlength="10" Name="ing_Amount"  rows="1" class= " form-control-sm inputForm withoutborders fc montocentrado" value="' + val.Amount + '"onkeyup = "maxvalue(this);calcing();calculogral();valamoub(this)",  oninput = "maxvalue(this);calcing();calculogral();valamoub(this)" onkeypress = "solonumerosptocoma();valamoub(this)"><span class="text-danger"></span></td>'));

                        var $removei = $('<a style="color:red; width: 37px; text-align: center;vertical-align: -webkit-baseline-middle;"  onclick="borrarfilaingb(this)"><span class="glyphicon glyphicon-remove"></span></a>');


                        $removei.click(function(e) {
                            e.preventDefault();
                            orderItemsi.splice(i, 1);
                            renewi();

                            ingreso();
                            //CALCULO TOTAL ing
                            arraysamountsedit();
                            calcing();


                            //FIN CALCULO TOTAL ing
                            //calculo total gral
                            calculogral();
                            //fin calculo total gral
                        });
                        $rowi.append($('<td style="width:2%"></td>').append($removei));
                        $('#ingresotabla > tbody:last').append($rowi);
                        itextarea();
                        //CALCULO TOTAL ing
                        arraysamountsedit();
                        calcing();

                        //FIN CALCULO TOTAL ing
                        //calculo total gral
                        calculogral();
                        //fin calculo total gral

                    });
                } else {
                    $('#orderItemsi').html('');
                }
            }

            function costo() {

                $('.elimc').remove();
                if (orderItemsc.length > 0) {
                    $('#orderItemsc').html('<span class="text-danger"></span>');
                    $.each(orderItemsc, function(i, val) {
                        var $rowc = $('<tr class="elimc"  style="background-color: white"></tr>');

                        $rowc.append($('<td style="width: 40%"><textarea maxlength="140" id="cos_SheetDescriptionz" Name="cos_SheetDescription" rows="1" class= " form-control-sm inputForm withoutborders fc sugc" value="' + val.SheetDescription + '" onkeyup = "valdescb(this)" oninput = "valdescb(this)" onkeypress = "valdescb(this)">' + val.SheetDescription + '</textarea><span class="text-danger"></span></td>'));
                        $rowc.append($('<td style="width: 40%"><textarea maxlength="140" id="cos_Commentsz"  Name="cos_Comments" rows="1" class= " form-control-sm inputForm withoutborders fc" value="' + val.Comments + '">' + val.Comments + '</textarea><span class="text-danger"></span></td>'));
                        $rowc.append($('<td><input type="number" id="cos_Amountz" maxlength="10" Name="cos_Amount" rows="1" class= " form-control-sm inputForm withoutborders fc montocentrado" value="' + val.Amount + '"onkeyup = "maxvalue(this);calccos();calculogral();valamoub(this)",  oninput = "maxvalue(this);calccos();calculogral();valamoub(this)" onkeypress = "solonumerosptocoma();valamoub(this)"><span class="text-danger"></span></td>'));
                        var $removec = $('<a style="color:red; width: 37px; text-align: center;vertical-align: -webkit-baseline-middle;"   onclick="borrarfilacosb(this)"><span class="glyphicon glyphicon-remove"></span></a>');
                        $removec.click(function(e) {
                            e.preventDefault();
                            orderItemsc.splice(i, 1);
                            renewc();

                            costo();
                            //CALCULO TOTAL cos
                            arraysamountsedit();

                            calccos();

                            //FIN CALCULO TOTAL cos
                            //calculo total gral
                            calculogral();
                            //fin calculo total gral
                        });
                        $rowc.append($('<td style="width: 2%"></td>').append($removec));
                        $('#costotabla > tbody:last').append($rowc);
                        itextarea();

                        //CALCULO TOTAL cos
                        arraysamountsedit();

                        calccos();

                        //FIN CALCULO TOTAL cos
                        //calculo total gral
                        calculogral();
                        //fin calculo total gral
                    });
                } else {
                    $('#orderItemsc').html('');
                }
            }

            function gasto() {

                $('.elimg').remove();
                if (orderItemsg.length > 0) {
                    $('#orderItemsg').html('<span class="text-danger"></span>');
                    $.each(orderItemsg, function(i, val) {
                        var $rowg = $('<tr class="elimg"  style="background-color: white"></tr>');
                        $rowg.append($('<td style="width: 40%"><textarea maxlength="140" id="gas_SheetDescriptionz" Name="gas_SheetDescription" rows="1" class= "form-control-sm inputForm withoutborders fc sugg" value="' + val.SheetDescription + '" onkeyup = "valdescb(this)" oninput = "valdescb(this)" onkeypress = "valdescb(this)">' + val.SheetDescription + '</textarea><span class="text-danger"></span></td>'));
                        $rowg.append($('<td style="width: 40%"><textarea maxlength="140" id="gas_Commentsz" Name="gas_Comments" rows="1" class= " form-control-sm inputForm withoutborders fc" value="' + val.Comments + '">' + val.Comments + '</textarea><span class="text-danger"></span></td>'));
                        $rowg.append($('<td><input type="number" id="gas_Amountz" maxlength="10" Name="gas_Amount" rows="1" class= " form-control-sm inputForm withoutborders fc montocentrado" value="' + val.Amount + '"onkeyup = "maxvalue(this);calcgas();calculogral();valamoub(this)",  oninput = "maxvalue(this);calcgas();calculogral();valamoub(this)" onkeypress = "solonumerosptocoma();valamoub(this)"><span class="text-danger"></span></td>'));

                        var $removeg = $('<a style="color:red; width: 37px; text-align: center;vertical-align: -webkit-baseline-middle;"  onclick="borrarfilagasb(this)"><span class="glyphicon glyphicon-remove"></span></a>');


                        $removeg.click(function(e) {
                            e.preventDefault();
                            orderItemsg.splice(i, 1);
                            renewg();

                            gasto();
                            //CALCULO TOTAL gas
                            arraysamountsedit();

                            calcgas();

                            //FIN CALCULO TOTAL gas
                            //calculo total gral
                            calculogral();
                            //fin calculo total gral
                        });
                        $rowg.append($('<td style="width: 2%"></td>').append($removeg));
                        $('#gastotabla > tbody:last').append($rowg);
                        //CALCULO TOTAL gas
                        itextarea();

                        arraysamountsedit();

                        calcgas();

                        //FIN CALCULO TOTAL gas
                        //calculo total gral
                        calculogral();
                        //fin calculo total gral

                    });
                } else {
                    $('#orderItemsg').html('');
                }
            }

            function otro() {

                $('.elimo').remove();
                if (orderItemso.length > 0) {
                    $('#orderItemso').html('<span class="text-danger"></span>');
                    $.each(orderItemso, function(i, val) {
                        var $rowo = $('<tr class="elimo"  style="background-color: white"></tr>');

                        $rowo.append($('<td style="width: 40%"><textarea maxlength="140" id="otr_SheetDescriptionz"  Name="otr_SheetDescription" rows="1" class= "form-control-sm inputForm withoutborders fc sugo" value="' + val.SheetDescription + '" onkeyup = "valdescb(this)" oninput = "valdescb(this)" onkeypress = "valdescb(this)">' + val.SheetDescription + '</textarea><span class="text-danger"></span></td>'));
                        $rowo.append($('<td style="width: 40%"><textarea maxlength="140" id="otr_Commentsz" Name="otr_Comments" rows="1" class= "form-control-sm inputForm withoutborders fc" value="' + val.Comments + '">' + val.Comments + '</textarea><span class="text-danger"></span></td>'));
                        $rowo.append($('<td><input type="number" id="otr_Amountz" Name="otr_Amount" rows="1" class= "form-control-sm inputForm withoutborders fc montocentrado" value="' + val.Amount + '"onkeyup = "maxvalue(this);calculogral();calcotr();valamoub(this)",  oninput = "maxvalue(this);calculogral();calcotr();valamoub(this)" onkeypress = "maxvalue(this);solonumerosptocoma();valamoub(this)"><span class="text-danger"></span></td>'));

                        var $removeo = $('<a style="color:red; width: 37px; text-align: center;vertical-align: -webkit-baseline-middle;"  onclick="borrarfilaotrb(this)"><span class="glyphicon glyphicon-remove"></span></a>');


                        $removeo.click(function(e) {
                            e.preventDefault();
                            orderItemso.splice(i, 1);
                            renewo();

                            otro();
                            //CALCULO TOTAL otr
                            arraysamountsedit();

                            calcotr();
                            //FIN CALCULO TOTAL otr
                            //calculo total gral
                            calculogral();
                            //fin calculo total gral
                        });
                        $rowo.append($('<td style="width: 2%"></td>').append($removeo));
                        $('#otrotabla > tbody:last').append($rowo);
                        //CALCULO TOTAL otr
                        itextarea();

                        arraysamountsedit();

                        calcotr();
                        //FIN CALCULO TOTAL otr
                        //calculo total gral
                        calculogral();
                        //fin calculo total gral


                    });
                } else {
                    $('#orderItemso').html('');
                }
            }

            //////fin funciones agregar ing cos gas otr///////
            //////////////////////////


        });
    </script>
}

